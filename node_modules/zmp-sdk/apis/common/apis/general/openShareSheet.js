import e from'./../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import r from'./../../../external/@swc/helpers/src/_object_spread.mjs.js';import n from'./../../../external/@swc/helpers/src/_object_spread_props.mjs.js';import t from"../../call/index.js";import i from"../../token.js";import{ZAPP_ID as l,APP_ID as s,ZALO_SUPPORT_SHARE_MULTI_IMAGE_VERSION as o}from"../../../constants.js";import a from"./getZMPShareInfo.js";import{__generator as u}from'./../../../external/tslib/tslib.es6.js';import{ShareSheetType as d}from"../../../types/enum.js";import c from"../../../appEnv/getEnv.js";var m,p=(m=e((function(e,m){var p,h,v,f,g,_,j,U,w,b,I,k;return u(this,(function(u){switch(u.label){case 0:switch(p={},h=e,e){case"text":return[3,1];case"image":return[3,2];case"gif":return[3,3];case"video":return[3,4];case"link":return[3,5];case"oa":return[3,6];case"zmp":return[3,7];case"zmp_deep_link":return[3,10]}return[3,13];case 1:return p={text:null==m?void 0:m.text,desc:(null==m?void 0:m.desc)||(null==m?void 0:m.description),autoParseLink:(null==m?void 0:m.autoParseLink)?1:0},[3,14];case 2:return _=[],j=(null===(f=c())||void 0===f?void 0:f.zaloVersion)||0,U=(null===(g=c())||void 0===g?void 0:g.platformName)||"unknown",Number(j)>=o[U]&&(h="multi_image"),Array.isArray(null==m?void 0:m.imageUrls)&&(null==m?void 0:m.imageUrls.length)>0?_=null==m?void 0:m.imageUrls:_.push(null==m?void 0:m.imageUrl),p={photoUrls:_,photoUrl:null==m?void 0:m.imageUrl,caption:null==m?void 0:m.caption},[3,14];case 3:return p={photoUrl:null==m?void 0:m.imageUrl,gifUrl:null==m?void 0:m.gifUrl,width:null==m?void 0:m.width,height:null==m?void 0:m.height},[3,14];case 4:return p={videoThumb:null==m?void 0:m.videoThumb,videoUrl:null==m?void 0:m.videoUrl,width:null==m?void 0:m.width,height:null==m?void 0:m.height},[3,14];case 5:return p={link:null==m?void 0:m.link,chatOnly:(null==m?void 0:m.chatOnly)?1:0},[3,14];case 6:return p={uid:null==m?void 0:m.id},[3,14];case 7:case 10:return[4,i.getAccessToken()];case 8:case 11:return v=u.sent(),[4,a(s,v||"",(null==m?void 0:m.title)||"",(null==m?void 0:m.description)||"",(null==m?void 0:m.thumbnail)||"",null==m?void 0:m.path)];case 9:return w=u.sent(),p={data:{ZInstantAPIInfo:{url:"".concat(w.zinstantApi),zinstantdata_id:"templateId=".concat(w.ztemplateId,"&appId=").concat(s,"&shareId=").concat(w.shareId)},previewMsgText:{msg:{en:"Zalo Mini Program",vi:"Chương trình nhỏ"}},enableReactions:1}},[3,14];case 12:return b=u.sent().shareableLink,I=new URL(b),k=I.searchParams.getAll("zshareId"),I.searchParams.delete("zshareId"),k.length>0&&I.searchParams.append("zshareId",k[0]),p={link:I.href,chatOnly:0},[3,14];case 13:return[3,14];case 14:return[2,new Promise((function(e,i){t("OPEN_SHARESHEET",n(r({type:d[h]},p),{zapp:l}),{success:function(r){e({status:null==r?void 0:r.status,shareType:null==r?void 0:r.share_type,numberOfUser:null==r?void 0:r.uid_to_size})},fail:function(e){i(e)}},{timeout:!1})}))]}}))})),function(e,r){return m.apply(this,arguments)});export{p as default};
