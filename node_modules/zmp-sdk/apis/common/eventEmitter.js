import e from'./../external/@swc/helpers/src/_class_call_check.mjs.js';import t from'./../external/@swc/helpers/src/_get.mjs.js';import n from'./../external/@swc/helpers/src/_get_prototype_of.mjs.js';import a from'./../external/@swc/helpers/src/_inherits.mjs.js';import r from'./../external/@swc/helpers/src/_create_super.mjs.js';import o from'./../external/eventemitter3/index.js';import s from"../utils/debug.js";import{stringToData as c}from"../utils/common.js";import{APP_ID as i}from"../constants.js";import{transformPaymentDataFromOnDataCallback as l,transformPaymentDataFromPath as m,PaymentConfig as u}from"./apis/general/payment/utils.js";import{Events as p}from"../types/enum.js";var d="ACTION_CALLBACK";var f=function(o){a(i,o);var c=r(i);function i(){var t;return e(this,i),(t=c.apply(this,arguments)).debug=s("zmp:event-emitter"),t}var l=i.prototype;return l.h5ConfirmHandleEvent=function(e,t,n){ZaloJavaScriptInterface.jsH5EventCallback(e,t,n||"")},l.on=function(e,a,r){var o=this;if(e===d||e===p.PaymentCallback)return t(n(i.prototype),"on",this).call(this,e,a,r);this.debug("register ".concat(String(e),": ").concat(r));return t(n(i.prototype),"on",this).call(this,e,(function(t,n){o.h5ConfirmHandleEvent(t,e,r),a(n)}),r)},l.once=function(e,a,r){var o=this;if(e===d)return t(n(i.prototype),"once",this).call(this,e,a,r);this.debug("register once ".concat(String(e),": ").concat(r));return t(n(i.prototype),"once",this).call(this,e,(function(t,n){o.h5ConfirmHandleEvent(t,e,r),a(n)}),r)},i.getInstance=function(){return i.instance||(i.instance=new i),i.instance},i}(o);function v(e){f.getInstance().on(d,e)}function h(e){f.getInstance().emit(d,e)}window.onNativeMessage=function(e,t){return function(n){h({serialId:e,actionName:t,result:n})}},window.zaloJSV2={zalo_h5_event_handler:function(e,t,n){var a=s("zmp:zalo_h5_event_handler");a("eventId: ".concat(e,", eventName: ").concat(t,", eventData: ").concat(n));var r=c(n);a("stringToData",r);var o=function(e,t){if(!t||"string"==typeof t)return t;try{if(e===p.OpenApp){var n=t.url,a=new URL(n),r=a.pathname.split("/zapps/".concat(i))[1];return{path:"".concat(r||"/").concat(a.search)}}return t}catch(e){return t}}(t,r),d=function(e,t,n,a){switch(!0){case"string"==typeof n||null===n:return[{eventName:e,eventId:t,data:n}];case e===p.OpenApp&&(null==a?void 0:a.enablePaymentDone):var r=m(n.path);return[{eventName:p.PaymentDone,eventId:t,data:r}];case e===p.OnDataCallback:if(["PAY_BY_BANK","PAY_BY_CUSTOM_METHOD"].includes(null==n?void 0:n.eventType))return[{eventName:p.OnDataCallback,eventId:t,data:n},{eventName:p.PaymentDone,eventId:t,data:l(n)}];break;default:return[{eventName:e,eventId:t,data:n}]}}(t,e,o,u);d.forEach((function(e){f.getInstance().emit(e.eventName,e.eventId,e.data)}))}},window.zaloNative2JS={nativeCall:function(e,t,n){f.getInstance().emit(p.PaymentCallback,e,t,n)}};export{f as MPEEmitter,h as fireActionMessage,v as onActionMessage};
