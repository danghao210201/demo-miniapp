import o from'./../external/@swc/helpers/src/_async_to_generator.mjs.js';import e from'./../external/@swc/helpers/src/_object_without_properties.mjs.js';import t from'./../external/@swc/helpers/src/_sliced_to_array.mjs.js';import n,{object as r,string as i}from'./../external/zod/lib/index.mjs.js';import s from"../appEnv/index.js";import a from"../common/notFound.js";import{functionHandler as l}from"../utils/decorator.js";import c from"../common/token.js";import m from"../common/apis/general/openProfile.js";import{__generator as d}from'./../external/tslib/tslib.es6.js';var p=[r({id:i(),guidingText:i().optional(),color:i().optional(),onStatusChange:n.function().optional(),onError:n.function().optional()}).catchall(n.any())];function u(o){return h.apply(this,arguments)}function h(){return h=o((function(n){return d(this,(function(r){return[2,l("showOAWidget",p,[n],(i=o((function(n){var r,i,l,p,u,h,f,g;return d(this,(function(j){if(s.isMp){try{r=document.getElementById(n.id),i=n.onStatusChange,l=n.guidingText,p=n.color,u=e(n,["onStatusChange","guidingText","color"]),r&&(h=document.createElement("iframe"),f="ifOAF-".concat(n.id,"-").concat(Date.now()),(g=new URL("https://h5.zalo.me/widgets/oa_widget.html")).searchParams.set("id",f),g.searchParams.set("appId",window.APP_ID),l&&g.searchParams.set("guidingText",l),p&&g.searchParams.set("color",p),Object.entries(u).forEach((function(o){var e=t(o,2),n=e[0],r=e[1];r&&g.searchParams.set("data-".concat(n),String(r))})),h.id=f,h.src=g.href,h.style.width="100%",h.style.height="100%",h.style.border="none",r.innerHTML=h.outerHTML,window.addEventListener("message",function(){var e=o((function(o){var e,t,n,r,s,a,l,p;return d(this,(function(d){switch(d.label){case 0:return e=o.data,o.origin.startsWith("https://h5.zalo.me")?(t=document.getElementById(f),n=e.type,(r=new URL(e.href)).origin!==g.origin||r.pathname!==g.pathname||e.id!==f?[3,3]:"followOA"!==n&&"getOAInfo"!==n?[3,2]:[4,c.jumpAndGetToken()]):[3,3];case 1:return d.sent(),l=null===(s=c.miniProgramConfig)||void 0===s?void 0:s.jwt,null==t||null===(a=t.contentWindow)||void 0===a||a.postMessage({type:n,payload:{jwt:l}},"*"),[3,3];case 2:"oaInfo"===n?null==i||i(null===(p=e.payload)||void 0===p?void 0:p.followed):"openOA"===n?m(e.payload.id,"oa"):"heightChange"===n&&(t.style.height="".concat(e.payload,"px")),d.label=3;case 3:return[2]}}))}));return function(o){return e.apply(this,arguments)}}(),!1))}catch(o){console.log(o)}return[2,Promise.resolve()]}return s.isMpWeb?[2,Promise.resolve()]:[2,Promise.reject(a("openMiniApp",{}))]}))})),function(o){return i.apply(this,arguments)}))];var i}))})),h.apply(this,arguments)}export{u as showOAWidget};
