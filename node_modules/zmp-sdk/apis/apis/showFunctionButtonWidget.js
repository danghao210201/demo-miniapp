import t from'./../external/@swc/helpers/src/_async_to_generator.mjs.js';import e from'./../external/@swc/helpers/src/_object_without_properties.mjs.js';import o from'./../external/@swc/helpers/src/_sliced_to_array.mjs.js';import n from'./../external/zod/lib/index.mjs.js';import r from"../appEnv/index.js";import i from"../common/notFound.js";import{functionHandler as s}from"../utils/decorator.js";import a from"../common/token.js";import{getAccessToken as c}from"./getAccessToken.js";import{__generator as l}from'./../external/tslib/tslib.es6.js';var d=[n.object({id:n.string(),type:n.string(),text:n.string(),color:n.string().optional(),disabled:n.boolean().optional(),onDataReceived:n.function().optional(),onError:n.function().optional()}).catchall(n.any())];function u(t){return m.apply(this,arguments)}function m(){return m=t((function(n){return l(this,(function(u){return[2,s("showFunctionButtonWidget",d,[n],(m=t((function(n){var s,d,u,m,p,f,h;return l(this,(function(y){if(r.isMp){try{s=document.getElementById(n.id),d=n.onDataReceived,u=n.onError,m=e(n,["onDataReceived","onError"]),s&&(p=document.createElement("iframe"),f="ifFBW-".concat(n.id,"-").concat(Date.now()),(h=new URL("https://h5.zalo.me/widgets/function_button_widget.html")).searchParams.set("id",f),h.searchParams.set("appId",window.APP_ID),Object.entries(m).forEach((function(t){var e=o(t,2),n=e[0],r=e[1];r&&h.searchParams.set("data-".concat(n),String(r))})),p.id=f,p.src=h.href,p.style.width="100%",p.style.height="100%",p.style.border="none",Object.entries(m).forEach((function(t){var e=o(t,2),n=e[0],r=e[1];r&&p.setAttribute("data-".concat(n),String(r))})),s.innerHTML=p.outerHTML,window.addEventListener("message",function(){var e=t((function(t){var e,o,n,r,i,s,p,y,g,v,j,w;return l(this,(function(l){switch(l.label){case 0:return e=t.data,t.origin.startsWith("https://h5.zalo.me")?(o=document.getElementById(f),n=e.type,(r=new URL(e.href)).origin!==h.origin||r.pathname!==h.pathname||e.id!==f?[3,4]:"buttonClicked"!==n?[3,3]:[4,a.jumpAndGetToken()]):[3,4];case 1:return l.sent(),y=null===(i=a.miniProgramConfig)||void 0===i?void 0:i.jwt,g=null===(s=a.miniProgramConfig)||void 0===s?void 0:s.encryptKey,[4,c()];case 2:return v=l.sent(),null==o||null===(p=o.contentWindow)||void 0===p||p.postMessage({type:n,payload:{jwt:y,encryptKey:g,accessToken:v}},"*"),[3,4];case 3:"onSuccess"===n?(null==(j=e.payload)?void 0:j.type)===m.type&&(null==d||d(null==j?void 0:j.data)):"onError"===n&&(null==(w=e.payload)?void 0:w.type)===m.type&&(null==u||u(null==w?void 0:w.data)),l.label=4;case 4:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),!1))}catch(t){console.log(t)}return[2,Promise.resolve()]}return r.isMpWeb?[2,Promise.resolve()]:[2,Promise.reject(i("showFunctionButtonWidget",{}))]}))})),function(t){return m.apply(this,arguments)}))];var m}))})),m.apply(this,arguments)}export{u as showFunctionButtonWidget};
